<?phpnamespace App\Http\Controllers\admin;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use Illuminate\Support\Facades\Validator;use Yajra\DataTables\Facades\DataTables;use Illuminate\Support\Facades\Auth;use App\Models\Chat;use App\Models\Chatthreads;use Session;class ChatController extends Controller{    public function __construct()    {    }    public function getChatthread($userId)    {        $chats = Chat::orWhere(['chat_to_user_id'=>$userId,'chat_from_user_id'=>$userId])->get();        return Datatables::of($chats)            ->addColumn('chat_from', function ($chat) {                return $chat->chat_from_user->full_name;            })            ->addColumn('chat_to', function ($chat) {                return $chat->chat_to_user->full_name;            })            ->addColumn('action', function ($chat) use($userId){                return '<a href="' . url('admin/chat/'.encodeId($chat->_id).'/user') . '/' . $userId . '" class="btn btn-sm btn-circle btn-default btn-editable"><i class="fa fa-search"></i> View</a>';            })            ->rawColumns([ 'action'])            ->make(true);    }    /**     * @param $id     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View     */    public function getChatDetail($chatId,$userId)    {        $threadMessages = Chatthreads::where('chat_id',decodeId($chatId))->get();       /* return $threadMessages;        dd($threadMessages);*/        return view('admin.chats.chat_detail',compact('threadMessages','userId'));    }    /**     * @param Request $request     * @return \Illuminate\Http\JsonResponse     */    public function deleteChatMessage(Request $request)    {        try{            Chatthreads::find(($request->messageId))->delete();            return response()->json(["status" => true, "message" => "Chat deleted successfuly."], 200);        }catch(\Exception $e){            return response()->json(["status" => false, "message" => $e->getMessage()], 400);        }    }}